var Collider=function(t){function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}var e={};return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=4)}([function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n={system:{maxPlanesPerMesh:250},quadrants:{size:{x:100,y:100,z:100}},plane:{dotBuffer:.001,collisionThreshold:.5},sandbox:{physics:{gravity:20,maxVelocity:50,floor:-.5,snapUp:1,snapDown:.5,minSlope:Math.PI/5,noclip:!1},player:{height:2,position:{x:0,y:0,z:0},rotation:{pitch:0,yaw:Math.PI,roll:0,maxPitch:.3*Math.PI,minPitch:-.3*Math.PI},speed:{normal:8,slowed:4,noclip:20,rotation:.75*Math.PI,jump:10,fallTimerThreshold:.2}},camera:{fov:60,aspect:1,near:.1,far:1e3},adjust:{verySlow:.01,slow:.025,normal:.05,fast:.09,rapid:.12,veryFast:.2}}};i.default=n},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=2*Math.PI,o=function(t){return new THREE.Vector3(t.x,t.y,t.z)},s=function(t,i){return new THREE.Vector3(t.x+i.x,t.y+i.y,t.z+i.z)},r=function(t,i){return new THREE.Vector3(t.x-i.x,t.y-i.y,t.z-i.z)},a=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==i?new THREE.Vector3(0,0,0):new THREE.Vector3(t.x/i,t.y/i,t.z/i)},h=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y);return 0==i?new THREE.Vector2(0,0):new THREE.Vector2(t.x/i,t.y/i)},l=function(t){return t.x*=-1,t.y*=-1,t.z*=-1,t},c=function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)+Math.pow(i.z-t.z,2))},u=function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.z-t.z,2))},f=function(t,i){var e=u(t,i),n=i.y-t.y;return Math.atan2(n,e)},p=function(t,i){return new THREE.Vector3(t.x*i,t.y*i,t.z*i)},y=function(t,i){return new THREE.Vector3(t.x*i.x,t.y*i.y,t.z*i.z)},d=function(t,i){return t.x===i.x&&t.y===i.y&t.z===i.z},m=function(t,i){return new THREE.Vector3(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)},g=function(t,i){return Math.atan2(Math.sin(i-t),Math.cos(i-t))},v=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z},x=function(t,i){return t.x*i.x+t.y*i.y};i.copyVector=o,i.isVectorEqual=d,i.pitchBetween=f,i.scaleByVector=y,i.twoPi=n,i.distanceBetween=c,i.distanceBetween2D=u,i.minAngleDifference=g,i.dotProduct=v,i.dotProduct2=x,i.addVector=s,i.subtractVector=r,i.scaleVector=p,i.crossProduct=m,i.reverseVector=l,i.normalise=a,i.normalise2=h},function(t,i,e){"use strict";function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.Collider=void 0;var o=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),s=e(0),r=function(t){return t&&t.__esModule?t:{default:t}}(s),a=e(1),h=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}(a),l=function(){function t(i,e){n(this,t),this.position=i,this.motion=e,this.falling=!1,this.config={},this.config.physics=r.default.sandbox.physics}return o(t,[{key:"gravity",value:function(t){this.falling=this.motion.y<0,this.motion.y=Math.max(this.motion.y-this.config.physics.gravity*t,-this.config.physics.maxVelocity)}},{key:"setPhysics",value:function(t){for(var i in t)t.hasOwnProperty(i)&&this.config.physics.hasOwnProperty(i)&&(this.config.physics[i]=t[i])}},{key:"move",value:function(t,i){var e=h.addVector(this.position,h.scaleVector(this.motion,t));if(!this.config.physics.noclip){this.gravity(t);var n=i.getCollisionMeshes(e);if(n.length>0)this.stepUpSlopes(e,n)&&(n=i.getCollisionMeshes(e)),this.feel(e,n,i)&&(n=i.getCollisionMeshes(e),this.stepUpSlopes(e,n));else if(this.motion.y<0&&!this.falling){var o=h.copyVector(e);o.y-=this.config.physics.snapDown;var s=i.getCeilingPlane(o);this.stepDownSlope(e,s)}}this.position.x=e.x,this.position.y=e.y,this.position.z=e.z,this.position.y<this.config.physics.floor&&(this.motion.y=0,this.position.y=this.config.physics.floor)}},{key:"feel",value:function(t,i,e){for(var n=!1,o=!1,s=0;s<i.length;s+=1){var r=i[s].getCeilingPlane(t);if(null!=r&&(r.plane.normal.y<this.config.physics.minSlope||r.y-this.position.y>this.config.physics.snapUp)){n=i[s];break}}if(n){var a=(h.copyVector(t),n.getIntersectPlane2D(this.position,t));if(null!=a){t.x=a.intersect.x,t.z=a.intersect.z;var l=0;i=e.getCollisionMeshes(t);for(var c=0;c<i.length;c+=1){var u=i[c].getCeilingPlane(t);null!=u&&(u.plane.normal.y<this.config.physics.minSlope||u.y-this.position.y>this.config.physics.snapUp)&&(l+=1)}l>1?(t.x=this.position.x,t.z=this.position.z):o=!0}else t.x=this.position.x,t.z=this.position.z}return o}},{key:"stepUpSlopes",value:function(t,i){for(var e=!1,n=0;n<i.length;n+=1){var o=i[n].getCeilingPlane(t);null!=o&&o.plane.normal.y>=this.config.physics.minSlope&&o.y-this.position.y<=this.config.physics.snapUp&&o.y>=t.y&&(e=!0,t.y=o.y,this.motion.y=0)}return e}},{key:"stepDownSlope",value:function(t,i){var e=!1;return null!=i&&i.plane.normal.y>=this.config.physics.minSlope&&(t.y=i.y,this.motion.y=0,e=!0),e}}]),t}();i.Collider=l},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=function(){this.cvs=document.createElement("canvas"),this.ctx=this.cvs.getContext("2d"),this.disabled=!1,this.init()};n.prototype={init:function(){document.body.appendChild(this.cvs),this.setStyle()},setStyle:function(){this.cvs.style.position="fixed",this.cvs.width=window.innerWidth,this.cvs.style.pointerEvents="none",this.cvs.height=400,this.cvs.style.zIndex=10,this.cvs.style.top=0,this.cvs.style.left=0},clear:function(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height)},format:function(t){return Math.floor(10*t)/10},formatVector:function(t){return this.format(t.x)+", "+this.format(t.y)+", "+this.format(t.z)},disable:function(){this.disabled=!0},print:function(){if(!this.disabled){this.clear();for(var t=0;t<arguments.length;t+=1)this.ctx.fillText(arguments[t],20,20+20*t)}}},i.default=n},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0}),i.Collider=i.Loader=i.Logger=i.Player=i.System=i.Mesh=void 0;var o=e(5),s=n(o),r=e(15),a=e(10),h=n(a),l=e(3),c=n(l),u=e(2),f=e(13),p=n(f);i.Mesh=s.default,i.System=r.System,i.Player=h.default,i.Logger=c.default,i.Loader=p.default,i.Collider=u.Collider},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var o=e(0),s=(n(o),e(6)),r=n(s),a=e(7),h=n(a),l=e(1),c=function(t){if(this.isColliderMesh=!0,!t.geometry.isBufferGeometry)throw"Error: Input is not THREE.BufferGeometry";this.object=t,this.geometry=t.geometry,this.box=(new THREE.Box3).setFromBufferAttribute(t.geometry.attributes.position),this.min=this.box.min,this.max=this.box.max,this.planes=[],this.transform=new h.default(t),this.generatePlanes(),this.conformPlanes()};c.prototype={generatePlanes:function(){var t=this.geometry.attributes.position.array,i=this.geometry.attributes.normal.array;if(this.geometry.index)for(var e=this.geometry.index.array,n=this.geometry.attributes.position.itemSize,o=0;o<e.length;o+=3){var s=e[o]*n,a=e[o+1]*n,h=e[o+2]*n;this.planes.push(new r.default(new THREE.Vector3(t[s],t[s+1],t[s+2]),new THREE.Vector3(t[a],t[a+1],t[a+2]),new THREE.Vector3(t[h],t[h+1],t[h+2]),new THREE.Vector3(i[s],i[s+1],i[s+2]),new THREE.Vector3(i[a],i[a+1],i[a+2]),new THREE.Vector3(i[h],i[h+1],i[h+2])))}else for(var l=0;l<t.length;l+=9)this.planes.push(new r.default(new THREE.Vector3(t[l+0],t[l+1],t[l+2]),new THREE.Vector3(t[l+3],t[l+4],t[l+5]),new THREE.Vector3(t[l+6],t[l+7],t[l+8]),new THREE.Vector3(i[l+0],i[l+1],i[l+2]),new THREE.Vector3(i[l+3],i[l+4],i[l+5]),new THREE.Vector3(i[l+6],i[l+7],i[l+8])))},conformPlanes:function(){var t=!1;if(!this.transform.default.scale){for(var i=0;i<this.planes.length;i+=1)this.transform.bakeScale(this.planes[i]);t=!0}if(!this.transform.default.rotation){for(var e=0;e<this.planes.length;e+=1)this.transform.bakeRotation(this.planes[e]);t=!0}if(t){for(var n=0;n<this.planes.length;n+=1)this.planes[n].generatePlane();this.setBoxFromPlanes()}},setBoxFromPlanes:function(){for(var t=[],i=0;i<this.planes.length;i+=1){var e=this.planes[i];t.push(e.p1),t.push(e.p2),t.push(e.p3)}this.box.setFromPoints(t)},getCollision:function(t){if(this.transform.set(t),this.box.containsPoint(this.transform.point)){for(var i=0;i<this.planes.length;i+=1)this.planes[i].culled=!1;for(var e=0;e<this.planes.length;e+=1)if(!this.planes[e].culled&&this.planes[e].isPointBelowOrEqual(this.transform.point))for(var n=0;n<this.planes.length;n+=1)!this.planes[n].culled&&n!=e&&this.planes[e].isPlaneAbove(this.planes[n])&&(this.planes[n].culled=!0);for(var o=0;o<this.planes.length;o+=1)if(!this.planes[o].culled&&!this.planes[o].isPointBelowOrEqual(this.transform.point))return!1;return!0}return!1},getCollision2D:function(t){return this.transform.set(t),this.transform.point.x>=this.min.x&&this.transform.point.x<=this.max.x&&this.transform.point.z>=this.min.z&&this.transform.point.z<=this.max.z},getCeiling2D:function(t){this.transform.set(t);for(var i=null,e=0;e<this.planes.length;e+=1)if(this.planes[e].containsPoint2D(this.transform.point)){var n=plane.getY(this.transform.point.x,this.transform.point.z);(null===i||n>i)&&(i=n)}return null==i?null:this.transform.reverseY(i)},getCeiling:function(t){this.transform.set(t);for(var i=null,e=0;e<this.planes.length;e+=1)if(this.planes[e].containsPoint2D(this.transform.point)&&this.planes[e].isPointBelowOrEqual(this.transform.point)){var n=plane.getY(this.transform.point.x,this.transform.point.z);n>=this.transform.point.y&&(null===i||n<i)&&(i=n)}return null==i?null:this.transform.reverseY(i)},getCeilingPlane:function(t){this.transform.set(t);for(var i=null,e=0;e<this.planes.length;e+=1)if(this.planes[e].containsPoint2D(this.transform.point)&&this.planes[e].containsPointPrecise2D(this.transform.point)&&this.planes[e].isPointBelowOrEqual(this.transform.point)){var n=this.planes[e].getY(this.transform.point.x,this.transform.point.z);null!=n&&n>=this.transform.point.y&&(null==i||n>i.y)&&(i={y:n,plane:this.planes[e]})}return null==i?null:{y:this.transform.reverseY(i.y),plane:i.plane}},getIntersectPlane:function(t,i){for(var e=this.transform.getTransformedPoint(t),n=this.transform.getTransformedPoint(i),o=(new THREE.Box3).setFromPoints([e,n]),s=null,r=0;r<this.planes.length;r+=1)if(this.planes[r].intersectsBox(o)||this.planes[r].containsBox(o)){var a=this.planes[r].getIntersect(e,n);if(null!=a){var h=(0,l.distanceBetween)(e,a);(null===s||h<s.distance)&&(s={intersect:a,plane:this.planes[r],distance:h})}}return null==s?null:{intersect:this.transform.reverse(s.intersect),plane:s.plane,distance:s.distance}},getIntersectPlane2D:function(t,i){for(var e=this.transform.getTransformedPoint(t),n=this.transform.getTransformedPoint(i),o=(new THREE.Box3).setFromPoints([e,n]),s=null,r=0;r<this.planes.length;r+=1)if(this.planes[r].intersectsBox(o)||this.planes[r].containsBox(o)){var a=this.planes[r].getNormalIntersect2D(n);if(null!=a){var h=(0,l.distanceBetween)(n,a);(null===s||h<s.distance)&&(s={plane:this.planes[r],intersect:a,distance:h})}}return null==s?null:{intersect:this.transform.reverse(s.intersect),plane:s.plane,distance:s.distance}}},i.default=c},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e(1),o=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}(n),s=e(0),r=function(t){return t&&t.__esModule?t:{default:t}}(s),a=function(t,i,e,n,o,s){this.p1=t,this.p2=i,this.p3=e,this.n1=n,this.n2=o,this.n3=s,this.culled=!1,this.generatePlane()};a.prototype={generatePlane:function(){this.e1={},this.e2={},this.e3={},this.e1.centre=o.scaleVector(o.addVector(this.p1,this.p2),.5),this.e2.centre=o.scaleVector(o.addVector(this.p2,this.p3),.5),this.e3.centre=o.scaleVector(o.addVector(this.p3,this.p1),.5),this.e1.vec=o.subtractVector(this.p2,this.p1),this.e2.vec=o.subtractVector(this.p3,this.p2),this.e3.vec=o.subtractVector(this.p1,this.p3),this.e1.vec2=new THREE.Vector2(this.e1.vec.x,this.e1.vec.z),this.e2.vec2=new THREE.Vector2(this.e2.vec.x,this.e2.vec.z),this.e3.vec2=new THREE.Vector2(this.e3.vec.x,this.e3.vec.z),this.e1.norm2=new THREE.Vector2(-this.e1.vec.z,this.e1.vec.x),this.e2.norm2=new THREE.Vector2(-this.e2.vec.z,this.e2.vec.x),this.e3.norm2=new THREE.Vector2(-this.e3.vec.z,this.e3.vec.x),this.normal=o.normalise(o.crossProduct(this.e3.vec,this.e1.vec)),this.normalXZ=new THREE.Vector3(this.normal.x,0,this.normal.z),o.dotProduct(this.normal,this.n1)<0&&o.dotProduct(this.normal,this.n2)<0&&o.dotProduct(this.normal,this.n3)<0&&(this.normal=o.reverseVector(this.normal)),this.position=new THREE.Vector3((this.p1.x+this.p2.x+this.p3.x)/3,(this.p1.y+this.p2.y+this.p3.y)/3,(this.p1.z+this.p2.z+this.p3.z)/3),this.D=-this.normal.x*this.position.x-this.normal.y*this.position.y-this.normal.z*this.position.z,this.box=(new THREE.Box3).setFromPoints([this.p1,this.p2,this.p3])},isPointAbove:function(t){var i=o.subtractVector(t,this.position);return o.dotProduct(i,this.normal)>0},isPointBelow:function(t){var i=o.subtractVector(t,this.position);return o.dotProduct(i,this.normal)<0},isPointAboveOrEqual:function(t){var i=o.subtractVector(t,this.position);return o.dotProduct(i,this.normal)>=-r.default.plane.dotBuffer},isPointBelowOrEqual:function(t){var i=o.subtractVector(t,this.position);return o.dotProduct(i,this.normal)<=r.default.plane.dotBuffer},isPointOnSurface:function(t){var i=o.subtractVector(t,this.position),e=o.dotProduct(i,this.normal);return e<=r.default.plane.dotBuffer&&e>=-r.default.plane.dotBuffer},isPlaneAbove:function(t){return this.isPointAboveOrEqual(t.p1)&&this.isPointAboveOrEqual(t.p2)&&this.isPointAboveOrEqual(t.p3)},containsPoint:function(t){return this.box.containsPoint(t)},containsBox:function(t){return this.box.containsBox(t)},intersectsBox:function(t){return this.box.intersectsBox(t)},containsPoint2D:function(t){return this.box.min.x<=t.x&&this.box.max.x>=t.x&&this.box.min.z<=t.z&&this.box.max.z>=t.z},containsPointPrecise2D:function(t){return o.dotProduct2({x:t.x-this.e1.centre.x,y:t.z-this.e1.centre.z},this.e1.norm2)<r.default.plane.dotBuffer&&o.dotProduct2({x:t.x-this.e2.centre.x,y:t.z-this.e2.centre.z},this.e2.norm2)<r.default.plane.dotBuffer&&o.dotProduct2({x:t.x-this.e3.centre.x,y:t.z-this.e3.centre.z},this.e3.norm2)<r.default.plane.dotBuffer},distanceToPlane:function(t){return Math.abs(this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.D)},getIntersect:function(t,i){var e=o.subtractVector(i,t),n=o.dotProduct(this.normal,o.normalise(e));if(Math.abs(n)<=r.default.plane.dotBuffer)return null;var s=this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.D,a=this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z;if(0==a)return null;var h=t.x-e.x*s/a,l=t.y-e.y*s/a,c=t.z-e.z*s/a,u=new THREE.Vector3(h,l,c);if(this.containsPoint(u)){if((new THREE.Box3).setFromPoints([i,t]).expandByScalar(.05).containsPoint(u))return u}return null},getNormalIntersect:function(t){var i=o.addVector(t,this.normal),e=o.subtractVector(i,t),n=this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.D,s=this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z,r=t.x-e.x*n/s,a=t.y-e.y*n/s,h=t.z-e.z*n/s;return new THREE.Vector3(r,a,h)},getNormalIntersect2D:function(t){var i=this.normal.x*t.x+this.normal.y*t.y+this.normal.z*t.z+this.D,e=this.normal.x*this.normal.x+this.normal.z*this.normal.z;return 0==e?null:new THREE.Vector3(t.x-this.normal.x*i/e,t.y,t.z-this.normal.z*i/e)},getY:function(t,i){return 0!=this.normal.y?(this.normal.x*t+this.normal.z*i+this.D)/-this.normal.y:null},getPerpendicularNormals:function(){return{right:new THREE.Vector3(-this.normal.z,0,this.normal.x),left:new THREE.Vector3(this.normal.z,0,-this.normal.x)}}},i.default=a},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e(1),o=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}(n),s=function(t){this.point=new THREE.Vector3,this.position=t.position,this.rotation=t.rotation,this.scale=t.scale,this.rotationOrder=t.rotation.order.split(""),this.axis={x:new THREE.Vector3(1,0,0),y:new THREE.Vector3(0,1,0),z:new THREE.Vector3(0,0,1)},this.checkDefault()};s.prototype={set:function(t){this.point.x=t.x-this.position.x,this.point.y=t.y-this.position.y,this.point.z=t.z-this.position.z},getTransformedPoint:function(t){return{x:t.x-this.position.x,y:t.y-this.position.y,z:t.z-this.position.z}},reverseY:function(t){return t+this.position.y},reverse:function(t){return{x:t.x+this.position.x,y:t.y+this.position.y,z:t.z+this.position.z}},bakeRotation:function(t){for(var i=this.rotationOrder.length-1;i>-1;i-=1)"X"==this.rotationOrder[i]?(t.p1.applyAxisAngle(this.axis.x,this.rotation.x),t.p2.applyAxisAngle(this.axis.x,this.rotation.x),t.p3.applyAxisAngle(this.axis.x,this.rotation.x),t.n1.applyAxisAngle(this.axis.x,this.rotation.x),t.n2.applyAxisAngle(this.axis.x,this.rotation.x),t.n3.applyAxisAngle(this.axis.x,this.rotation.x)):"Y"==this.rotationOrder[i]?(t.p1.applyAxisAngle(this.axis.y,this.rotation.y),t.p2.applyAxisAngle(this.axis.y,this.rotation.y),t.p3.applyAxisAngle(this.axis.y,this.rotation.y),t.n1.applyAxisAngle(this.axis.y,this.rotation.y),t.n2.applyAxisAngle(this.axis.y,this.rotation.y),t.n3.applyAxisAngle(this.axis.y,this.rotation.y)):"Z"==this.rotationOrder[i]&&(t.p1.applyAxisAngle(this.axis.z,this.rotation.z),t.p2.applyAxisAngle(this.axis.z,this.rotation.z),t.p3.applyAxisAngle(this.axis.z,this.rotation.z),t.n1.applyAxisAngle(this.axis.z,this.rotation.z),t.n2.applyAxisAngle(this.axis.z,this.rotation.z),t.n3.applyAxisAngle(this.axis.z,this.rotation.z))},bakeScale:function(t){t.p1=o.scaleByVector(t.p1,this.scale),t.p2=o.scaleByVector(t.p2,this.scale),t.p3=o.scaleByVector(t.p3,this.scale)},checkDefault:function(){this.default={position:0==this.position.x&&0==this.position.y&&0==this.position.z,rotation:0==this.rotation.x&&0==this.rotation.y&&0==this.rotation.z,scale:1==this.scale.x&&1==this.scale.y&&1==this.scale.z}}},i.default=s},,function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e(0),o=function(t){return t&&t.__esModule?t:{default:t}}(n),s=function(){this.q=[]};s.prototype={positionToQuadrant:function(t){return{x:Math.floor(t.x/o.default.quadrants.size.x),y:Math.floor(t.y/o.default.quadrants.size.y),z:Math.floor(t.z/o.default.quadrants.size.z)}},add:function(t){for(var i=this.positionToQuadrant(t.min),e=this.positionToQuadrant(t.max),n=i.x;n<=e.x;n+=1)for(var o=i.y;o<=e.y;o+=1)for(var s=i.z;s<=e.z;s+=1)this.addToQuadrant(n,o,s,t)},addToQuadrant:function(t,i,e,n){this.q[t]||(this.q[t]=[]),this.q[t][i]||(this.q[t][i]=[]),this.q[t][i][e]||(this.q[t][i][e]=[]),this.q[t][i][e].push(n)},getQuadrantMeshes:function(t){var i=this.positionToQuadrant(t);return this.q[i.x]&&this.q[i.x][i.y]&&this.q[i.x][i.y][i.z]?this.q[i.x][i.y][i.z]:[]}},i.default=s},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var s=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),r=e(1),a=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}(r),h=e(2),l=e(0),c=n(l),u=e(11),f=n(u),p=e(14),y=function(){function t(i){o(this,t),this.domElement=i,this.config=c.default.sandbox.player,this.config.adjust=c.default.sandbox.adjust,this.config.physics=c.default.sandbox.physics,this.minPitch=this.config.rotation.minPitch,this.maxPitch=this.config.rotation.maxPitch,this.position=new THREE.Vector3(this.config.position.x,this.config.position.y,this.config.position.z),this.rotation={pitch:this.config.rotation.pitch,yaw:this.config.rotation.yaw,roll:this.config.rotation.roll},this.motion=new THREE.Vector3(0,0,0),this.offset={rotation:{pitch:0,yaw:0,roll:0}},this.target={position:new THREE.Vector3(this.config.position.x,this.config.position.y,this.config.position.z),rotation:{pitch:this.config.rotation.pitch,yaw:this.config.rotation.yaw,roll:this.config.rotation.roll},motion:new THREE.Vector3(0,0,0),offset:{rotation:{pitch:0,yaw:0,roll:0}}},this.falling=!1,this.fallTimer=0,this.collider=new h.Collider(this.target.position,this.motion),this.object=new THREE.Group,this.camera=new THREE.PerspectiveCamera(c.default.sandbox.camera.fov,c.default.sandbox.camera.aspect,c.default.sandbox.camera.near,c.default.sandbox.camera.far),this.camera.up=new THREE.Vector3(0,1,0),this._events(),this.resizeCamera()}return s(t,[{key:"_events",value:function(){var t=this;this.mouse=new f.default(this.domElement),this.onMouseDown=function(i){t.mouse.isLocked()||t.mouse.start(i,t.rotation.pitch,t.rotation.yaw)},this.onMouseMove=function(i){!t.mouse.isActive()||t.keyboard.keys.left||t.keyboard.keys.right||(t.mouse.move(i),t.target.rotation.yaw=t.mouse.getYaw(),t.target.rotation.pitch=t.mouse.getPitch(t.minPitch,t.maxPitch))},this.onMouseUp=function(i){t.mouse.stop()},this.domElement.addEventListener("mousedown",this.onMouseDown,!1),this.domElement.addEventListener("mousemove",this.onMouseMove,!1),this.domElement.addEventListener("mouseup",this.onMouseUp,!1),this.domElement.addEventListener("mouseleave",this.onMouseUp,!1),this.onMobileDown=function(i){t.onMouseDown(i.touches[0])},this.onMobileMove=function(i){t.onMouseMove(i.touches[0])},this.onMobileUp=function(i){t.onMouseUp(i.touches[0])},this.domElement.addEventListener("touchstart",this.onMobileDown,!1),this.domElement.addEventListener("touchmove",this.onMobileMove,!1),this.domElement.addEventListener("touchend",this.onMobileUp,!1),this.keyboard=new p.Keyboard,document.addEventListener("keydown",this.keyboard.onKeyDown,!1),document.addEventListener("keyup",this.keyboard.onKeyUp,!1)}},{key:"update",value:function(t,i){this.input(t),this.collider.move(t,i),this.move()}},{key:"input",value:function(t){if(this.keyboard.keys.left||this.keyboard.keys.right){var i=(this.keyboard.keys.left?1:0)+(this.keyboard.keys.right?-1:0);this.target.rotation.yaw+=this.config.speed.rotation*t*i}if(this.keyboard.keys.up||this.keyboard.keys.down){var e=this.config.physics.noclip?this.config.speed.noclip*(1-Math.abs(Math.sin(this.target.rotation.pitch))):this.config.speed.normal,n=(this.keyboard.keys.up?1:0)+(this.keyboard.keys.down?-1:0),o=this.rotation.yaw+this.offset.rotation.yaw,s=Math.sin(o)*e*n,r=Math.cos(o)*e*n;this.target.motion.x=s,this.target.motion.z=r}else this.target.motion.x=0,this.target.motion.z=0;if(this.keyboard.keys.jump&&((0==this.motion.y||this.fallTimer<this.config.speed.fallTimerThreshold)&&(this.motion.y=this.config.speed.jump,this.fallTimer=this.config.speed.fallTimerThreshold),this.keyboard.releaseKey("jump")),this.falling=0!=this.motion.y,this.fallTimer=this.falling?this.fallTimer+t:0,this.keyboard.keys.x&&(this.keyboard.releaseKey("x"),this.config.physics.noclip=0==this.config.physics.noclip),this.config.physics.noclip){if(this.keyboard.keys.up||this.keyboard.keys.down){var a=(this.keyboard.keys.up?1:0)+(this.keyboard.keys.down?-1:0),h=this.target.rotation.pitch;this.target.motion.y=Math.sin(h)*this.config.speed.noclip*a}else this.target.motion.y=0;this.falling=!1,this.motion.y=this.target.motion.y}this.falling?(this.motion.x+=(this.target.motion.x-this.motion.x)*this.config.adjust.slow,this.motion.z+=(this.target.motion.z-this.motion.z)*this.config.adjust.slow):(this.motion.x=this.target.motion.x,this.motion.z=this.target.motion.z)}},{key:"move",value:function(){this.position.x+=(this.target.position.x-this.position.x)*this.config.adjust.veryFast,this.position.y+=(this.target.position.y-this.position.y)*this.config.adjust.veryFast,this.position.z+=(this.target.position.z-this.position.z)*this.config.adjust.veryFast,this.rotation.yaw+=a.minAngleDifference(this.rotation.yaw,this.target.rotation.yaw)*this.config.adjust.fast,this.offset.rotation.yaw+=(this.target.offset.rotation.yaw-this.offset.rotation.yaw)*this.config.adjust.normal,this.rotation.yaw+=this.rotation.yaw<0?a.twoPi:this.rotation.yaw>a.twoPi?-a.twoPi:0,this.rotation.pitch+=(this.target.rotation.pitch-this.rotation.pitch)*this.config.adjust.normal,this.offset.rotation.pitch+=(this.target.offset.rotation.pitch-this.offset.rotation.pitch)*this.config.adjust.normal,this.rotation.roll+=(this.target.rotation.roll-this.rotation.roll)*this.config.adjust.fast;var t=this.rotation.pitch+this.offset.rotation.pitch,i=this.rotation.yaw+this.offset.rotation.yaw,e=this.position.y+this.config.height,n=1-Math.abs(Math.sin(t));this.camera.up.z=-Math.sin(this.rotation.yaw)*this.rotation.roll,this.camera.up.x=Math.cos(this.rotation.yaw)*this.rotation.roll,this.camera.position.set(this.position.x-Math.sin(i)*n/4,e-1*Math.sin(t)/4,this.position.z-Math.cos(i)*n/4),this.camera.lookAt(new THREE.Vector3(this.position.x+Math.sin(i)*n,e+1*Math.sin(t),this.position.z+Math.cos(i)*n)),this.object.position.set(this.position.x,this.position.y,this.position.z)}},{key:"resizeCamera",value:function(){var t=this.domElement.getBoundingClientRect(),i=t.width,e=t.height;this.camera.aspect=i/e,this.camera.updateProjectionMatrix()}}]),t}();i.default=y},function(t,i,e){"use strict";function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),s=function(){function t(i){n(this,t),this.domElement=i,this.x=0,this.y=0,this.origin=new THREE.Vector2(0,0),this.delta=new THREE.Vector2(0,0),this.rotation={pitch:0,yaw:0,roll:0},this.locked=!1,this.active=!1}return o(t,[{key:"start",value:function(t,i,e){this.active=!0;var n=this.domElement.getBoundingClientRect();this.origin.x=(t.clientX-n.x)/n.width*2-1,this.origin.y=(t.clientY-n.y)/n.height*2-1,this.rotation.pitch=i,this.rotation.yaw=e}},{key:"move",value:function(t){var i=this.domElement.getBoundingClientRect();this.x=(t.clientX-i.x)/i.width*2-1,this.y=(t.clientY-i.y)/i.height*2-1,this.delta.x=this.x-this.origin.x,this.delta.y=this.y-this.origin.y}},{key:"stop",value:function(){this.active=!1}},{key:"getPitch",value:function(t,i){var e=Math.max(t,Math.min(i,this.rotation.pitch+this.delta.y));return e!=t&&e!=i||(this.origin.y=this.y,this.rotation.pitch=e),e}},{key:"getYaw",value:function(){return this.rotation.yaw+this.delta.x}},{key:"isActive",value:function(){return this.active}},{key:"isLocked",value:function(){return this.locked}}]),t}();i.default=s},,function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e(0),o=function(t){return t&&t.__esModule?t:{default:t}}(n),s=function(t){this.basePath=t,this.init()};s.prototype={init:function(){this.FBXLoader=new THREE.FBXLoader,this.envTextureCube=(new THREE.CubeTextureLoader).load([this.basePath+"envmap/horizontal.jpg",this.basePath+"envmap/horizontal.jpg",this.basePath+"envmap/posy.jpg",this.basePath+"envmap/negy.jpg",this.basePath+"envmap/horizontal.jpg",this.basePath+"envmap/horizontal.jpg"])},loadFBX:function(t){var i=this;return new Promise(function(e,n){try{i.FBXLoader.load(i.basePath+t,function(t){for(var n=[],o=0;o<t.children.length;o+=1)if("Mesh"==t.children[o].type)n.push(t.children[o]);else if("Group"==t.children[o].type)for(var s=0;s<t.children[o].children.length;s+=1)"Mesh"==t.children[o].children[s].type&&n.push(t.children[o].children[s]);for(var r=0;r<n.length;r+=1){var a=n[r].material;a.envMap=i.envTextureCube,a.envMapIntensity=.25,a.bumpScale=.01,a.normalScale=new THREE.Vector2(.1,.1)}e(n)})}catch(t){n(t)}})},process:function(t,i){for(var e=0;e<t.children.length;e+=1){var n=t.children[e],s=i.materialsInfo[n.material.name];if(n.material=i.materials[n.material.name],console.log(s,n.material),s.map_ka){var r=n.geometry.attributes.uv.array,a=s.map_ka,h=(new THREE.TextureLoader).load(self.basePath+a);n.material.lightMap=h,n.material.lightMapIntensity=o.default.Loader.lightMapIntensity,n.geometry.addAttribute("uv2",new THREE.BufferAttribute(r,2))}n.material.map&&(n.material.color=new THREE.Color(16777215),-1!==n.material.map.image.src.indexOf(".png")&&(n.material.transparent=!0,n.material.side=THREE.DoubleSide),-1!=n.material.map.image.src.indexOf("glass")&&(n.material.transparent=!0,n.material.opacity=o.default.Loader.glassOpacity))}},loadOBJ:function(t){var i=this;return new Promise(function(e,n){try{i.materialLoader.load(t+".mtl",function(n){n.preload(),i.objectLoader.load(t+".obj",function(t){i.process(t,n),e(t)})})}catch(t){n(t)}})}},i.default=s},function(t,i,e){"use strict";function n(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),s=function(){function t(){n(this,t),this.keys={},this._events()}return o(t,[{key:"_events",value:function(){var t=this;this.onKeyDown=function(i){switch(i.keyCode){case 38:case 87:t.keys.up=!0;break;case 37:case 65:t.keys.left=!0;break;case 40:case 83:t.keys.down=!0;break;case 39:case 68:t.keys.right=!0;break;case 32:t.keys.jump=!0;break;case 88:t.keys.x=!0}},this.onKeyUp=function(i){switch(i.keyCode){case 38:case 87:t.keys.up=!1;break;case 37:case 65:t.keys.left=!1;break;case 40:case 83:t.keys.down=!1;break;case 39:case 68:t.keys.right=!1}},this.pressKey=function(i){t.keys[i]=!0},this.releaseKey=function(i){t.keys[i]=!1}}}]),t}();i.Keyboard=s},function(t,i,e){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.System=void 0;var s=function(){function t(t,i){for(var e=0;e<i.length;e++){var n=i[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(i,e,n){return e&&t(i.prototype,e),n&&t(i,n),i}}(),r=e(0),a=n(r),h=e(9),l=n(h),c=function(){function t(){o(this,t),this.quadrants=new l.default,this.meshes=[],this.isColliderSystem=!0}return s(t,[{key:"add",value:function(){for(var t=0;t<arguments.length;t+=1){var i=arguments[t];if(!i.isColliderMesh)throw"Error: Input must be Collider.Mesh";i.planes.length<=a.default.system.maxPlanesPerMesh?(this.quadrants.add(i),this.meshes.push(i.object)):console.warn("Warning: Mesh not included - plane count exceeds maximum (%s).",a.default.system.maxPlanesPerMesh)}}},{key:"getCollision",value:function(t){for(var i=!1,e=this.quadrants.getQuadrantMeshes(t),n=0;n<e.length;n+=1)if(e[n].getCollision(t)){i=!0;break}return i}},{key:"getCollisionMeshes",value:function(t){for(var i=[],e=this.quadrants.getQuadrantMeshes(t),n=0;n<e.length;n+=1)e[n].getCollision(t)&&i.push(e[n]);return i}},{key:"getCeilingPlane",value:function(t){for(var i=null,e=this.quadrants.getQuadrantMeshes(t),n=0;n<e.length;n+=1)if(e[n].getCollision(t)){var o=e[n].getCeilingPlane(t);null!=o&&(null===i||o.y>i.y)&&(i={y:o.y,plane:o.plane})}return null===i?null:i}},{key:"getMeshes",value:function(){return this.meshes}}]),t}();i.System=c}]);